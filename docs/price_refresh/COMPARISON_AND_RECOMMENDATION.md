# Периодический рефреш цен: сравнение сценариев и рекомендация

## Таблица сравнения

| Сценарий | Идея | Надёжность | Скорость (UX) | Нагрузка | Сложность внедрения | Инфраструктура |
|---|---|---:|---:|---:|---:|---|
| 1. HTMX polling + OOB | Клиент опрашивает, сервер отдаёт OOB‑HTML цен | 9/10 | 8/10 | 6/10 | 3/10 | текущая (Django+HTMX) |
| 2. SWR кеш + фон | Кеш‑ответ сразу + фоновая ревалидация | 10/10 | 9/10 | 8/10 | 5/10 | желательно Redis + worker |
| 3. SSE push | Долгое соединение, сервер пушит дифф | 7/10 | 9/10 | 7/10 | 7/10 | ASGI/streaming + настройка прокси |
| 4. WebSocket (Channels) | Realtime, двусторонняя синхронизация | 7/10 | 10/10 | 8/10 | 9/10 | Channels + Redis + ASGI |

Пояснения:
- **Надёжность**: устойчивость в Telegram WebView, моб. сетях, при сбоях CargoTech.
- **Скорость (UX)**: насколько «быстро» пользователь видит обновления без перерисовки списка/потери скролла.
- **Нагрузка**: влияние на внешний API и наш сервер при росте онлайна.

## Рекомендация (оптимум по надёжности и скорости)
**Выбор: Сценарий 1 (HTMX polling + OOB)** как базовое решение, с возможностью эволюции в **Сценарий 2 (SWR)** при росте онлайна.

Почему:
- **Надёжность** высокая: нет постоянных соединений, минимальные риски в Telegram WebApp.
- **Скорость** достаточная: обновляется только DOM цены, без перерисовки списка и без сброса scroll.
- **Внедрение** минимально: используется существующий стек (HTMX уже в проекте), без Channels/SSE.

Когда стоит перейти на Сценарий 2:
- если интервал обновления нужно уменьшить до 5–10 секунд и/или растёт число пользователей
- если CargoTech начинает жёстко лимитировать запросы


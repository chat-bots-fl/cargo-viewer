# üì¶ –§–ò–ù–ê–õ–¨–ù–´–ô –ü–ê–ö–ï–¢ –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–ò –ü–†–û–ï–ö–¢–ê

> ‚ö†Ô∏è **DEPRECATED (v2.0/v2.1).** –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `INDEX_v3.1.md` (v3.1, 4 —è–Ω–≤–∞—Ä—è 2026). –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏.

**–î–∞—Ç–∞:** 29 –¥–µ–∫–∞–±—Ä—è 2025  
**–ü—Ä–æ–µ–∫—Ç:** CargoTech Driver WebApp v2.1  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–û –ö –†–ê–ó–†–ê–ë–û–¢–ö–ï

---

## üìö –°–û–î–ï–†–ñ–ê–ù–ò–ï –ü–ê–ö–ï–¢–ê

### üéØ –û–¢–ß–ï–¢–´ –ò –ê–ù–ê–õ–ò–ó–´ (4 –¥–æ–∫—É–º–µ–Ω—Ç–∞)

1. **summary_of_changes.md** ‚Üê –ù–ê–ß–ù–ò–¢–ï –û–¢–°–Æ–î–ê
   - –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –≤—Å–µ—Ö 6 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
   - Diff –¥–æ/–ø–æ—Å–ª–µ
   - –ö–æ–¥ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ weight_volume categories
   - –ß–ï–ö-–õ–ò–°–¢ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

2. **final_compliance_report.md**
   - 100% –∏—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞
   - –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è FR/NFR –ø–æ–∫—Ä—ã—Ç—ã
   - –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ 2 –Ω–µ–¥–µ–ª–∏
   - –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

3. **risk_analysis_final.md**
   - –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö 6 —Ä–µ—à–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
   - 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è cache strategy
   - Rate limiting –∞–ª–≥–æ—Ä–∏—Ç–º
   - Security —É—Å–∏–ª–µ–Ω–∏–∏

4. **compliance_report.md**
   - –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (PCAM, PBS, API, Contracts)
   - –ú–∞—Ç—Ä–∏—Ü—ã –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
   - –ò—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üìñ –ò–°–•–û–î–ù–´–ï –î–û–ö–£–ú–ï–ù–¢–´ –ü–†–û–ï–ö–¢–ê (9 —Ñ–∞–π–ª–æ–≤)

–≠—Ç–∏ —Ñ–∞–π–ª—ã –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ PDF –∏ –æ–±–Ω–æ–≤–∏—Ç—å:

1. **01_TECHNICAL_SPECIFICATION.md**
   - ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å: FR-4 (–¥–æ–±–∞–≤–∏—Ç—å extranote)
   - ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å: NFR-1.2 (< 2s –≤–º–µ—Å—Ç–æ < 1s)

2. **02_PCAM_ANALYSIS.md**
   - ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑)

3. **03_PBS_STRUCTURE.md**
   - ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

4. **04_API_SPECIFICATION.md**
   - ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å: filter[weight_volume] (7 –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
   - ‚úÖ –î–æ–±–∞–≤–∏—Ç—å: extranote –≤ Response Schema

5. **05_CONTRACTS.md**
   - ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å: Contract 1.1 (max_age_seconds)
   - ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å: Contract 2.1 (rate limiting + cache + extranote)
   - ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å: Contract 2.3 (cache strategy –ø–æ–ª–Ω–æ—Å—Ç—å—é)
   - ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å: Contract 3.1 (weight_volume –ø–∞—Ä–∞–º–µ—Ç—Ä)

6. **06_PROJECT_STRUCTURE.md**
   - ‚úÖ –î–æ–±–∞–≤–∏—Ç—å: apps/filtering/constants.py (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

7. **07_CODE_GENERATION_RULES.md**
   - ‚úÖ –î–æ–±–∞–≤–∏—Ç—å: –ø—Ä–∏–º–µ—Ä—ã weight_volume normalization (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

8. **08_VERTICAL_SLICING_PLAN.md**
   - ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é)

9. **AGENTS.md**
   - ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å: lessons learned –∏–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üîß –ö–û–ù–ö–†–ï–¢–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –î–õ–Ø –ö–ê–ñ–î–û–ì–û –§–ê–ô–õ–ê

### 01_TECHNICAL_SPECIFICATION.md

```diff
–†–ê–ó–î–ï–õ: FR-4 –î–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –≥—Ä—É–∑–∞

–î–æ–±–∞–≤–∏—Ç—å:
+ - **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è** (–µ—Å–ª–∏ present)
+   - –ò—Å—Ç–æ—á–Ω–∏–∫: extranote (raw text from API)
+   - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ not NULL
+   - –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ: monospace —à—Ä–∏—Ñ—Ç (tahoma/courier, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã)
+   - –ü—Ä–∏–º–µ—Ä—ã: 
+     - "–ì—Ä—É–∑ –≥–æ—Ç–æ–≤ ‚úì | –û–ø–ª–∞—á–µ–Ω–æ –∞–≤–∞–Ω—Å–æ–º | –†–µ—Ñ—Ä–∏–∂ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"
+     - "–¢–æ–ª—å–∫–æ –ò–ü | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ | –î–û–ü–û–ì –∑–∞–ø—Ä–µ—Ç"

–†–ê–ó–î–ï–õ: NFR-1 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–ë–´–õ–û:
- NFR-1.2: –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ –≥—Ä—É–∑–∞: < 1 —Å–µ–∫

–ò–°–ü–†–ê–í–ò–¢–¨ –ù–ê:
+ NFR-1.2: –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ –≥—Ä—É–∑–∞: < 2 —Å–µ–∫ (p95)
+   - p50: < 500ms (cached data shown immediately)
+   - p95: < 2000ms (with fetch + loading spinner)
+   - Fallback: Show cached data if API timeout
```

### 04_API_SPECIFICATION.md

```diff
–†–ê–ó–î–ï–õ: ENDPOINT 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≥—Ä—É–∑–æ–≤ ‚Üí Query Parameters

–ë–´–õ–û:
{
  "filter[w][v]": "10-54",  # –í–µ—Å/–æ–±—ä–µ–º (–Ω–µ—è—Å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)
}

–ò–°–ü–†–ê–í–ò–¢–¨ –ù–ê:
{
  "filter[weight_volume]": "1_3",    # 1-3 —Ç / –¥–æ 15 –º¬≥
  "filter[weight_volume]": "3_5",    # 3-5 —Ç / 15-25 –º¬≥
  "filter[weight_volume]": "5_10",   # 5-10 —Ç / 25-40 –º¬≥
  "filter[weight_volume]": "10_15",  # 10-15 —Ç / 40-60 –º¬≥
  "filter[weight_volume]": "15_20",  # 15-20 —Ç / 60-82 –º¬≥
  "filter[weight_volume]": "20",     # 20+ —Ç / 82+ –º¬≥
  "filter[weight_volume]": "any"     # –ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ (default)
}

–¢–∞–±–ª–∏—Ü–∞ –∑–Ω–∞—á–µ–Ω–∏–π:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ó–Ω–∞—á–µ–Ω–∏–µ‚îÇ –í–µ—Å –º–∏–Ω–∏–º—É–º      ‚îÇ –û–±—ä–µ–º –º–∏–Ω–∏–º—É–º   ‚îÇ –û–±—ä–µ–º –º–∞–∫—Å–∏–º—É–º  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ "1_3"   ‚îÇ 1000 –∫–≥ (1 —Ç)    ‚îÇ 0 –º¬≥            ‚îÇ 15 –º¬≥           ‚îÇ
‚îÇ "3_5"   ‚îÇ 3000 –∫–≥ (3 —Ç)    ‚îÇ 15 –º¬≥           ‚îÇ 25 –º¬≥           ‚îÇ
‚îÇ "5_10"  ‚îÇ 5000 –∫–≥ (5 —Ç)    ‚îÇ 25 –º¬≥           ‚îÇ 40 –º¬≥           ‚îÇ
‚îÇ "10_15" ‚îÇ 10000 –∫–≥ (10 —Ç)  ‚îÇ 40 –º¬≥           ‚îÇ 60 –º¬≥           ‚îÇ
‚îÇ "15_20" ‚îÇ 15000 –∫–≥ (15 —Ç)  ‚îÇ 60 –º¬≥           ‚îÇ 82 –º¬≥           ‚îÇ
‚îÇ "20"    ‚îÇ 20000 –∫–≥ (20 —Ç)  ‚îÇ 82 –º¬≥           ‚îÇ 999999 –º¬≥       ‚îÇ
‚îÇ "any"   ‚îÇ 0 –∫–≥             ‚îÇ 0 –º¬≥            ‚îÇ ‚àû (no filter)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–†–ê–ó–î–ï–õ: ENDPOINT 2: –î–µ—Ç–∞–ª–∏ –≥—Ä—É–∑–∞ ‚Üí Response Schema

–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ "cargo_type":
+ "extranote": "–ì—Ä—É–∑ –≥–æ—Ç–æ–≤, –µ—Å—Ç—å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞, —Ä–µ—Ñ—Ä–∏–∂ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω",
+ @description: Additional requirements from shipper (may contain critical info)
+ @type: Optional[str]
+ @examples:
+   - "–ì—Ä—É–∑ –≥–æ—Ç–æ–≤ ‚úì | –û–ø–ª–∞—á–µ–Ω–æ –∞–≤–∞–Ω—Å–æ–º | –†–µ—Ñ—Ä–∏–∂ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω | –î–û–ü–û–ì –∑–∞–ø—Ä–µ—Ç"
+   - "–¢–æ–ª—å–∫–æ –ò–ü | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (9-18 —á) | –ë–µ–∑ –Ω–∞–ª–∏—á–Ω—ã—Ö"
+   - "–¢–†–ï–ë–£–ï–¢–°–Ø –°–í–ò–î–ï–¢–ï–õ–¨–°–¢–í–û –î–û–ü–û–ì | –û–ø–∞—Å–Ω—ã–π –≥—Ä—É–∑ –∫–ª–∞—Å—Å 3"
```

### 05_CONTRACTS.md

```diff
CONTRACT 1.1: TelegramAuthService.validate_init_data()

PARAMETERS –¥–æ–±–∞–≤–∏—Ç—å:
+ - max_age_seconds: int = 300
+   @constraint: 300-3600 (5 –º–∏–Ω—É—Ç - 1 —á–∞—Å)
+   @default: 300 (5 –º–∏–Ω—É—Ç)
+   @rationale: Prevent replay attacks using stale credentials

GUARANTEES –¥–æ–±–∞–≤–∏—Ç—å:
+ - Timestamp Validation: Reject if auth_date older than max_age_seconds
+ - Prevent: Replay attacks and credential reuse
+ - Constant-time: String comparison (no timing attacks)
+ - Secret Management: bot_token from environment (Django SECRET_KEY)
+ - Monitoring: All validation failures logged (ERROR level)
+ - Alerts: If > 10 failures in 1 minute (attack detection)

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

CONTRACT 2.1: CargoAPIClient.fetch_cargos()

RETURNS –¥–æ–±–∞–≤–∏—Ç—å:
+ - extranote: Optional[str]  # Additional requirements from shipper

GUARANTEES –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ Circuit Breaker section:
+ 
+ Rate Limit Handling:
+   - Per-request headers: X-RateLimit-Limit, X-RateLimit-Remaining
+   - On 429: Retry after X-RateLimit-Reset-After (exponential backoff)
+   - Soft limit: Start queuing at 80% capacity
+   - Queue strategy: FIFO with max 1000 requests
+   - Backoff pattern: 500ms ‚Üí 1500ms ‚Üí 3000ms (+ random jitter)
+   - Max attempts: 4 (then error to user)
+   - Logging: Every 429 with user_id, endpoint, timestamp
+
+ Cache Integration:
+   - Cargo list cache TTL: 5 minutes (per-user)
+   - Detail cache TTL: 15 minutes (per-cargo)
+   - Fallback: Return cached data if API timeout (max 1 hour old)
+   - Invalidation triggers: filter change, logout, new cargo posted

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

CONTRACT 2.3: CargoService.get_cargos()

GUARANTEES –æ–±–Ω–æ–≤–∏—Ç—å Cache section –Ω–∞:

+ Cache Levels & Strategy:
+
+ Level 1: Per-User Cargo List
+   Key: "user:{user_id}:cargos:{filter_hash}"
+   Data: List[CargoCard]
+   TTL: 5 minutes
+   Invalidation: filter change, logout, new cargo posted (webhook)
+
+ Level 2: Cargo Detail
+   Key: "cargo:{cargo_id}:detail"
+   Data: Full cargo object
+   TTL: 15 minutes
+   Invalidation: webhook from CargoTech, status change, manual
+
+ Level 3: Autocomplete (Cities/Regions)
+   Key: "autocomplete:cities"
+   Data: City reference dictionary
+   TTL: 24 hours
+   Invalidation: Manual (static data)
+
+ Fallback Strategy:
+   - Redis unavailable: All requests ‚Üí API (no cache)
+   - API unavailable: Serve stale cache (up to 1 hour old) with warning
+   - Cache miss: Fetch from API + async update

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

CONTRACT 3.1: FilterService.validate_filters()

PARAMETERS –¥–æ–±–∞–≤–∏—Ç—å:
+ - weight_volume: Optional[str] in ["1_3", "3_5", "5_10", "10_15", "15_20", "20", "any"]
+   @constraint: Predefined categories only
+   @default: "any" (no filter)
+   @mapping: See WEIGHT_VOLUME_CATEGORIES constant

RETURNS –¥–æ–±–∞–≤–∏—Ç—å:
+ - weight_min: Optional[int] (kg)
+ - weight_max: Optional[int] (kg)
+ - volume_min: Optional[int] (m¬≥)
+ - volume_max: Optional[int] (m¬≥)
```

### 06_PROJECT_STRUCTURE.md (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```diff
–î–æ–±–∞–≤–∏—Ç—å –≤ –£–†–û–í–ï–ù–¨ 2: –ú–û–î–£–õ–ò ‚Üí M3 —Ä–∞–∑–¥–µ–ª:

M3.4 Weight/Volume Categories Mapper
‚îú‚îÄ‚îÄ constants.py (WEIGHT_VOLUME_CATEGORIES dictionary)
‚îú‚îÄ‚îÄ services.py (normalize_weight_volume_filter function)
‚îî‚îÄ‚îÄ tests/test_weight_volume.py (unit tests)

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
apps/filtering/
‚îú‚îÄ‚îÄ constants.py  ‚Üê NEW
‚îÇ   ‚îî‚îÄ WEIGHT_VOLUME_CATEGORIES dict
‚îÇ   ‚îî‚îÄ WEIGHT_VOLUME_OPTIONS list
‚îú‚îÄ‚îÄ services.py
‚îÇ   ‚îî‚îÄ normalize_weight_volume_filter(value: str) -> dict
‚îî‚îÄ‚îÄ tests/
    ‚îî‚îÄ test_weight_volume.py
```

---

## üíª –ö–û–î –î–õ–Ø –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø

### –§–∞–π–ª: apps/filtering/constants.py (–Ω–æ–≤—ã–π)

```python
"""
Weight/Volume filter categories for CargoTech API
Defines predefined cargo capacity ranges
"""

WEIGHT_VOLUME_CATEGORIES = {
    "1_3": {
        "label": "1-3 —Ç / –¥–æ 15 –º¬≥",
        "weight_min_kg": 1000,
        "weight_max_kg": 3000,
        "volume_min_m3": 0,
        "volume_max_m3": 15,
    },
    "3_5": {
        "label": "3-5 —Ç / 15-25 –º¬≥",
        "weight_min_kg": 3000,
        "weight_max_kg": 5000,
        "volume_min_m3": 15,
        "volume_max_m3": 25,
    },
    "5_10": {
        "label": "5-10 —Ç / 25-40 –º¬≥",
        "weight_min_kg": 5000,
        "weight_max_kg": 10000,
        "volume_min_m3": 25,
        "volume_max_m3": 40,
    },
    "10_15": {
        "label": "10-15 —Ç / 40-60 –º¬≥",
        "weight_min_kg": 10000,
        "weight_max_kg": 15000,
        "volume_min_m3": 40,
        "volume_max_m3": 60,
    },
    "15_20": {
        "label": "15-20 —Ç / 60-82 –º¬≥",
        "weight_min_kg": 15000,
        "weight_max_kg": 20000,
        "volume_min_m3": 60,
        "volume_max_m3": 82,
    },
    "20": {
        "label": "20+ —Ç / 82+ –º¬≥",
        "weight_min_kg": 20000,
        "weight_max_kg": 999999,
        "volume_min_m3": 82,
        "volume_max_m3": 999999,
    },
}

# Frontend select options (order matters)
WEIGHT_VOLUME_OPTIONS = [
    ("any", "–õ—é–±–æ–π –≤–µ—Å –∏ –æ–±—ä–µ–º"),
    ("1_3", "1-3 —Ç / –¥–æ 15 –º¬≥"),
    ("3_5", "3-5 —Ç / 15-25 –º¬≥"),
    ("5_10", "5-10 —Ç / 25-40 –º¬≥"),
    ("10_15", "10-15 —Ç / 40-60 –º¬≥"),
    ("15_20", "15-20 —Ç / 60-82 –º¬≥"),
    ("20", "20+ —Ç / 82+ –º¬≥"),
]
```

### –ö–æ–¥: –§—É–Ω–∫—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ (–≤ apps/filtering/services.py)

```python
from django.core.exceptions import ValidationError
from .constants import WEIGHT_VOLUME_CATEGORIES

class FilterService:
    
    @staticmethod
    def normalize_weight_volume_filter(value: str) -> dict:
        """
        Convert frontend weight_volume select value to API parameters
        
        Contract: Implements Contract 3.1 validation
        
        Args:
            value: "1_3", "3_5", "5_10", "10_15", "15_20", "20", "any", or empty
            
        Returns:
            {
                "weight_min_kg": int,
                "weight_max_kg": int,
                "volume_min_m3": int,
                "volume_max_m3": int,
            }
            or {} if value is "any" or empty (no filter)
            
        Raises:
            ValidationError: if value is not a valid category
            
        Examples:
            >>> normalize_weight_volume_filter("1_3")
            {"weight_min_kg": 1000, "weight_max_kg": 3000, 
             "volume_min_m3": 0, "volume_max_m3": 15}
            
            >>> normalize_weight_volume_filter("any")
            {}  # No filter applied
        """
        if not value or value == "any":
            return {}  # No filter
        
        if value not in WEIGHT_VOLUME_CATEGORIES:
            raise ValidationError(
                f"Invalid weight_volume value: {value}. "
                f"Must be one of: {', '.join(WEIGHT_VOLUME_CATEGORIES.keys())} or 'any'"
            )
        
        category = WEIGHT_VOLUME_CATEGORIES[value]
        return {
            "weight_min_kg": category["weight_min_kg"],
            "weight_max_kg": category["weight_max_kg"],
            "volume_min_m3": category["volume_min_m3"],
            "volume_max_m3": category["volume_max_m3"],
        }
```

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –ß–ï–ö-–õ–ò–°–¢

–î–æ –∑–∞–ø—É—Å–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

- [ ] –°–∫–∞—á–∞—Ç—å –≤—Å–µ 4 –æ—Ç—á–µ—Ç–∞ (summary, final, risk, compliance)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å 5 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ (01, 04, 05, 06 –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, 07 –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª apps/filtering/constants.py
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é normalize_weight_volume_filter –≤ services.py
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Contract tests –¥–ª—è weight_volume
- [ ] –£—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é —Å Product Owner
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å Django environment
- [ ] –ù–∞—á–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É M1 (Authentication)

---

## üìä –°–í–û–î–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–ô

```
–ü—Ä–æ–±–ª–µ–º: 6 –≤—ã—è–≤–ª–µ–Ω–æ ‚Üí 6 —Ä–µ—à–µ–Ω–æ
‚îú‚îÄ‚îÄ extranote        ‚úÖ –ó–ê–ö–†–´–¢–û
‚îú‚îÄ‚îÄ weight_volume    ‚úÖ –ó–ê–ö–†–´–¢–û
‚îú‚îÄ‚îÄ NFR-1.2 < 1s     ‚úÖ –ó–ê–ö–†–´–¢–û
‚îú‚îÄ‚îÄ Rate limiting    ‚úÖ –ó–ê–ö–†–´–¢–û
‚îú‚îÄ‚îÄ Cache strategy   ‚úÖ –ó–ê–ö–†–´–¢–û
‚îî‚îÄ‚îÄ Telegram security‚úÖ –ó–ê–ö–†–´–¢–û

–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ: 95% ‚Üí 100%
–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: üü° —É—Å–ª–æ–≤–Ω–æ–µ ‚Üí ‚úÖ –ø–æ–ª–Ω–∞—è
```

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!** üöÄ

–í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –æ–¥–Ω–æ–º –ø–∞–∫–µ—Ç–µ:
1. summary_of_changes.md (–Ω–∞—á–Ω–∏—Ç–µ –æ—Ç—Å—é–¥–∞!)
2. final_compliance_report.md (–ø–æ–ª–Ω—ã–π –ø–ª–∞–Ω)
3. risk_analysis_final.md (–≤—Å–µ —Ä–µ—à–µ–Ω–∏—è)
4. compliance_report.md (–¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑)

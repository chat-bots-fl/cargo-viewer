# Быстрый запуск проекта

## Новый способ: Вариант 2 (Разделение на подготовку и запуск)

### Windows

#### Первый запуск или при изменениях:
```cmd
setup.bat
```

#### Повторный запуск (каждый раз):
```cmd
start.bat
```

### WSL/Linux

**Автоматическая установка ngrok в WSL!**

#### Первый запуск или при изменениях:
```bash
chmod +x setup.sh start.sh
./setup.sh
```

Скрипт автоматически:
- ✅ Проверит наличие ngrok
- ✅ Предложит установить ngrok через snap (если не найден)
- ✅ Создаст/обновит виртуальное окружение
- ✅ Установит зависимости
- ✅ Применит миграции
- ✅ Соберёт статику

#### Повторный запуск (каждый раз):
```bash
./start.sh
```

Скрипт автоматически:
- ✅ Запустит ngrok (если установлен в WSL)
- ✅ Получит URL ngrok
- ✅ Обновит .env
- ✅ Запустит Django
- ✅ Настроит webhook

**Примечание:** Если ngrok не установлен в WSL, `setup.sh` предложит установить его автоматически через snap.

---

## Что делают скрипты

### setup.bat / setup.sh (Подготовка окружения)
Выполняется **один раз** или при изменениях:
- ✅ Проверка .env файла
- ✅ Создание виртуального окружения
- ✅ Установка зависимостей
- ✅ Применение миграций БД
- ✅ Сбор статических файлов

**Время выполнения:** 1-2 минуты (первый раз), 5-10 секунд (повторно)

### start.bat / start.sh (Запуск сервисов)
Выполняется **каждый раз**:
- ✅ Запуск ngrok в отдельном окне
- ✅ Получение URL ngrok
- ✅ Обновление .env с новым URL
- ✅ Запуск Django сервера в отдельном окне
- ✅ Настройка webhook для Telegram бота

**Время выполнения:** 10-15 секунд

---

## Преимущества нового подхода

1. **Быстрый повторный запуск** - только запуск сервисов, без проверки зависимостей
2. **Чёткое разделение** - подготовка отдельно от запуска
3. **Легкая отладка** - проблемы с зависимостями? → `setup.sh`, проблемы с ngrok? → `start.sh`
4. **Гибкость** - можно запускать только подготовку или только сервисы

---

## Полный рабочий процесс

### Первый запуск
```bash
# Windows
setup.bat    # Подготовка окружения (1-2 минуты)
start.bat    # Запуск сервисов (10-15 секунд)

# WSL/Linux
./setup.sh    # Подготовка окружения (1-2 минуты)
./start.sh    # Запуск сервисов (10-15 секунд)
```

### Повторный запуск
```bash
# Windows
start.bat    # Только запуск сервисов (10-15 секунд)

# WSL/Linux
./start.sh    # Только запуск сервисов (10-15 секунд)
```

### После изменений в requirements.txt
```bash
# Windows
setup.bat    # Обновление зависимостей
start.bat    # Запуск сервисов

# WSL/Linux
./setup.sh    # Обновление зависимостей
./start.sh    # Запуск сервисов
```

---

## Проверка работоспособности

1. **Проверьте ngrok**: Откройте URL ngrok в браузере
2. **Проверьте webhook**: Команда `python setup_telegram_webhook.py info` должна показать ваш URL
3. **Проверьте бота**: Отправьте `/start` в Telegram боте

---

## Решение проблем

### Ошибка ERR_NGROK_3200
**Причина**: ngrok не запущен
**Решение**: Запустите `start.bat` (Windows) или `./start.sh` (WSL/Linux)

### Бот не реагирует на /start
**Причины**:
1. Webhook не настроен → выполните `python setup_telegram_webhook.py setup`
2. URL в .env устарел → запустите `start.bat` / `./start.sh` для обновления
3. Django не запущен → запустите `start.bat` / `./start.sh`

### Webhook показывает ошибку
**Проверка**:
```bash
python setup_telegram_webhook.py info
```
Если есть ошибка, удалите и создайте заново:
```bash
python setup_telegram_webhook.py delete
python setup_telegram_webhook.py setup
```

---

## Полезные команды

### Управление webhook
```bash
# Информация о webhook
python setup_telegram_webhook.py info

# Удалить webhook
python setup_telegram_webhook.py delete

# Настроить webhook
python setup_telegram_webhook.py setup
```

### Проверка процессов
```bash
# Windows
tasklist | findstr /i "ngrok python"

# WSL/Linux
ps aux | grep -E "ngrok|python"
```

---

## Структура запуска

```
Окно 1              Окно 2              Окно 3
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  ngrok      │    │  Django     │    │  Webhook    │
│  http 8000  │    │  runserver  │    │  setup      │
│             │    │             │    │             │
│ https://... │    │ http://...  │    │ Webhook OK  │
└─────────────┘    └─────────────┘    └─────────────┘
```

---

## Примечания

- **ngrok URL меняется** при каждом перезапуске ngrok
- **Не забывайте запускать setup** при изменении зависимостей
- **Webhook нужно перенастраивать** при изменении URL (автоматически в start.sh)
- **Django сервер должен быть запущен** для работы webhook

---

## Старые скрипты (устаревшие)

Следующие скрипты всё ещё доступны, но **не рекомендуются**:

- `start_all.bat` - устаревший единый скрипт для Windows
- `start_all_v2.bat` - устаревший улучшенный скрипт для Windows
- `start_ngrok.bat` - только запуск ngrok
- `run_local.sh` - полный запуск с Redis (используйте setup.sh + start.sh)
- `run_local.bat` - полный запуск для Windows (используйте setup.bat + start.bat)

---

## Дополнительная документация

- [`LAUNCH_OPTIONS.md`](LAUNCH_OPTIONS.md) - Сравнение вариантов запуска
- [`LOCAL_RUN.md`](LOCAL_RUN.md) - Полное руководство по локальному запуску
- [`QUICKSTART.md`](QUICKSTART.md) - Общее руководство по проекту

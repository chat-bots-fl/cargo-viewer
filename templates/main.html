{% extends "base.html" %}
{% block body %}
  <header class="app-header">
    <div class="app-title">CargoTech Driver WebApp</div>
    <div class="app-meta">
      <span id="driver-name" class="muted">…</span>
      <a class="link" href="{% url 'paywall' %}">Подписка</a>
    </div>
  </header>

  <main class="app-main">
    <section class="card">
      <div class="card-title">Фильтры</div>
      <form id="filters-form" class="filters">
        <div class="row">
          <label>Погрузка (город)</label>
          <div class="input-with-clear">
            <input id="start_city_query" type="text" placeholder="Начните ввод…" autocomplete="off" />
            <button type="button" class="input-clear" data-clear-target="start_city_query" aria-label="Сбросить" title="Сбросить">×</button>
          </div>
          <input id="start_point_id" name="start_point_id" type="hidden" />
          <input id="start_point_type" name="start_point_type" type="hidden" />
          <div id="start_city_suggest" class="suggest"></div>
        </div>
        <div class="row">
          <label>Выгрузка (город)</label>
          <div class="input-with-clear">
            <input id="finish_city_query" type="text" placeholder="Начните ввод…" autocomplete="off" />
            <button type="button" class="input-clear" data-clear-target="finish_city_query" aria-label="Сбросить" title="Сбросить">×</button>
          </div>
          <input id="finish_point_id" name="finish_point_id" type="hidden" />
          <input id="finish_point_type" name="finish_point_type" type="hidden" />
          <div id="finish_city_suggest" class="suggest"></div>
        </div>
        <div class="row">
          <label>Дата</label>
          <div class="input-with-clear">
            <input id="start_date" name="start_date" type="date" />
            <button type="button" class="input-clear" data-clear-target="start_date" aria-label="Сбросить" title="Сбросить">×</button>
          </div>
        </div>
        <div class="row">
          <label>Вес/Объём</label>
          <div class="input-with-clear has-dropdown">
            <select id="weight_volume" name="weight_volume">
              <option value="">Любой</option>
              <option value="20-83">20т/83м³</option>
              <option value="15-65">15т/65м³</option>
              <option value="10-54">10т/54м³</option>
              <option value="7.5-45">7.5т/45м³</option>
              <option value="5-36">5т/36м³</option>
              <option value="3-16">3т/16м³</option>
              <option value="1.5-9">1.5т/9м³</option>
            </select>
            <button type="button" class="input-clear" data-clear-target="weight_volume" aria-label="Сбросить" title="Сбросить">×</button>
          </div>
        </div>
        <div class="row">
          <label>Тип погрузки</label>
          <div id="load-types-dropdown" class="input-with-clear has-dropdown">
            <input id="load_types" name="load_types" type="hidden" />
            <button type="button" id="load-types-toggle" class="select-toggle" aria-haspopup="listbox" aria-expanded="false">Любой</button>
            <button type="button" class="input-clear" data-clear-target="load_types" aria-label="Сбросить" title="Сбросить">×</button>
            <div id="load-types-menu" class="dropdown-menu" role="listbox" aria-multiselectable="true" hidden>
              <div class="muted" style="padding:10px 12px;">Загрузка…</div>
            </div>
          </div>
        </div>
        <div class="row">
          <label>Тип кузова</label>
          <div id="truck-types-dropdown" class="input-with-clear has-dropdown">
            <input id="truck_types" name="truck_types" type="hidden" />
            <button type="button" id="truck-types-toggle" class="select-toggle" aria-haspopup="listbox" aria-expanded="false">Любой</button>
            <button type="button" class="input-clear" data-clear-target="truck_types" aria-label="Сбросить" title="Сбросить">×</button>
            <div id="truck-types-menu" class="dropdown-menu" role="listbox" aria-multiselectable="true" hidden>
              <div class="muted" style="padding:10px 12px;">Загрузка…</div>
            </div>
          </div>
        </div>
        <div class="actions">
          <button type="button" id="apply-filters" class="btn">Применить</button>
          <button type="button" id="reset-filters" class="btn btn-secondary">Сброс</button>
        </div>
      </form>
    </section>

    <section class="card">
      <div class="card-title">Грузы</div>
      <div id="cargo-count" class="muted cargo-count"></div>
      <div id="cargo-list">
        <div class="muted">Авторизация…</div>
      </div>
    </section>
  </main>

  <div id="modal-root" class="modal-root hidden" aria-hidden="true">
    <div class="modal-backdrop" data-modal-close="1"></div>
    <div class="modal" role="dialog" aria-modal="true">
      <div id="modal-header" class="modal-header">
        <div class="modal-title"></div>
        <button class="btn btn-icon" type="button" data-modal-close="1">✕</button>
      </div>
      <div id="modal-body" class="modal-body">
        {% include "cargos/components/loading_spinner.html" %}
      </div>
    </div>
  </div>

  <section id="dev-auth" class="dev-auth hidden">
    <div class="card">
      <div class="card-title">Dev auth</div>
      <p class="muted">Если вы не в Telegram, вставьте initData вручную.</p>
      <textarea id="dev-initdata" rows="4" placeholder="initData из Telegram WebApp"></textarea>
      <div class="actions">
        <button type="button" id="dev-login" class="btn">Войти</button>
      </div>
    </div>
  </section>
{% endblock %}
